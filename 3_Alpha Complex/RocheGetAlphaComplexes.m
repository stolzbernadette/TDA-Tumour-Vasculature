%% Construct alpha complex with GUDHI
% 14.12.2019


clear all
clc

categories = ["Treated","Treated",...
    "Treated","Treated","Treated",...
    "Treated","Treated","Treated","Treated","Treated",...
    "Treated","Treated","Treated",...
    "Control", "Control", "Control", "Control", "Control", ...
    "Control", "Control", "Control", "Control", "Control",...
    "Control", "Control", "Control", "Control", "Control",...
    "Control", "Control", "Control"];

short_categories = ["Tr","Tr",...
    "Tr","Tr","Tr",...
    "Tr","Tr","Tr","Tr","Tr",...
    "Tr","Tr","Tr",...
    "Ctrl", "Ctrl", "Ctrl", "Ctrl", "Ctrl", ...
    "Ctrl", "Ctrl", "Ctrl", "Ctrl", "Ctrl",...
    "Ctrl", "Ctrl", "Ctrl", "Ctrl", "Ctrl",...
    "Ctrl", "Ctrl", "Ctrl"];
    
tumours = ["201",...
    "202","203","204","205",...
    "401","402",...
    "403","404","703","705",...
    "10-2","10-5",...
    "101","102",...
    "103","104","105",...
    "301","301","302","302",...
    "303","303","304","304",...
    "305","305","403","404",...
    "405"];
    

       
    
days = ["1",...
    "1","1","1","1",...
    "3","3",...
    "3","3","7","7",...%
    "14","14",...
    "1","1",...
    "1","1","1",...
    "3","7","3","7",...
    "3","7","3","7",...
    "3","7","14","14",...
    "14"];

    
file_ids = ["Treat201.1d",...
    "Treat202.1d","Treat203.1d","Treat204.1d","Treat205.1d",...%
    "Treat401.3d","Treat402.3d",...
    "Treat403.3d","Treat404.3d","Treat703.7d","Treat705.7d",...%
    "Treat10-2.14d","Treat10-5.14d",...
    "Veh101.1d","Veh102.1d",...
    "Veh103.1d","Veh104.1d","Veh105.1d",...
    "Veh301.3d","Veh301.7d","Veh302.3d","Veh302.7d",...
    "Veh303.3d","Veh303.7d","Veh304.3d","Veh304.7d",...
    "Veh305.3d","Veh305.7d","Veh403.14d","Veh404.14d",...
    "Veh405.14d"]



folders = ["Treat201.1d/",...
    "Treat202.1d/","Treat203.1d/","Treat204.1d/","Treat205.1d/",...%
    "Treat401.3d/","Treat402.3d/",...
    "Treat403.3d/","Treat404.3d/","Treat703.7d/","Treat705.7d/",...%
    "Treat10-2.14d/","Treat10-5.14d/",...
    "Veh101.1d/","Veh102.1d/",...
    "Veh103.1d/","Veh104.1d/","Veh105.1d/",...
    "Veh301.3d/","Veh301.7d/","Veh302.3d/","Veh302.7d/",...
    "Veh303.3d/","Veh303.7d/","Veh304.3d/","Veh304.7d/",...
    "Veh305.3d/","Veh305.7d/","Veh403.14d/","Veh404.14d/",...
    "Veh405.14d/"]

parfor data_file_number = 1:length(tumours)
    
    tumour = tumours(data_file_number);
    day = days(data_file_number);
    folder = folders(data_file_number);
    category = categories(data_file_number);

    point_cloud_filename2 =  [char(category) '_' char(tumour) '_'  char(day)];

    input_path = char(['input/' num2str(point_cloud_filename2) '.txt']);
    
    output_path = ['output/' num2str(point_cloud_filename2) '.txt'];
    
    sprintf(['GUDHI code opened file for ' point_cloud_filename2])

    unixstring=['./alpha_complex_persistence -p 2 -o ' output_path ' ' input_path];
    [status,cmdout] = unix(unixstring);
    
    gudhi_reformat_output( output_path );
    
    sprintf(['Done with folder ' char(point_cloud_filename)])

    
end

delete(gcp) 

